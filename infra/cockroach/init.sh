#!/bin/sh

./cockroach sql --insecure --host="cockroachdb" --execute=" CREATE TABLE IF NOT EXISTS "metrics" ("id_repository" int8 NOT NULL, "coverage" decimal(5,2) NOT NULL, "bugs" int8 NOT NULL, "vulnerabilities" int8 NOT NULL, "hotspot" int8 NOT NULL, "code_smells" int8 NOT NULL, CONSTRAINT "REL_c3d911b1d911a990e617041947" UNIQUE ("id_repository"), CONSTRAINT "PK_c3d911b1d911a990e617041947b" PRIMARY KEY ("id_repository")); CREATE INDEX IF NOT EXISTS "IDX_c3d911b1d911a990e617041947" ON "metrics" ("id_repository"); CREATE SEQUENCE IF NOT EXISTS "organization_id_organization_seq"; CREATE TABLE IF NOT EXISTS "organization" ("id_organization" INT DEFAULT nextval('"organization_id_organization_seq"') NOT NULL, "name" varchar NOT NULL, "status" int8 NOT NULL DEFAULT (1), CONSTRAINT "PK_c1137363ad9deea0a4e9c6ff32b" PRIMARY KEY ("id_organization")); CREATE SEQUENCE IF NOT EXISTS "tribe_id_tribe_seq"; CREATE TABLE IF NOT EXISTS "tribe" ("id_tribe" INT DEFAULT nextval('"tribe_id_tribe_seq"') NOT NULL, "name" varchar(50) NOT NULL, "status" int8 NOT NULL DEFAULT (1), "id_organization" int8, CONSTRAINT "PK_c165ed5e52b4e2ff2af9a7d0fb6" PRIMARY KEY ("id_tribe")); CREATE INDEX IF NOT EXISTS "IDX_dcdd03e44f28bdf784d4331482" ON "tribe" ("id_organization"); CREATE SEQUENCE IF NOT EXISTS "repository_id_repository_seq"; CREATE TABLE IF NOT EXISTS "repository" ("id_repository" INT DEFAULT nextval('"repository_id_repository_seq"') NOT NULL, "name" varchar(50) NOT NULL, "state" varchar(1) NOT NULL, "create_time" timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP(6), "status" varchar(1) NOT NULL DEFAULT 'A', "id_tribe" int8, CONSTRAINT "PK_431a174129d882e2c5398a9f420" PRIMARY KEY ("id_repository")); CREATE INDEX IF NOT EXISTS "IDX_3572e75b71052040481c022dfd" ON "repository" ("id_tribe"); SELECT * FROM information_schema.constraint_table_usage; ALTER TABLE "metrics" DROP CONSTRAINT IF EXISTS "FK_c3d911b1d911a990e617041947b"; ALTER TABLE "metrics" ADD CONSTRAINT "FK_c3d911b1d911a990e617041947b" FOREIGN KEY ("id_repository") REFERENCES "repository"("id_repository") ON DELETE NO ACTION ON UPDATE NO ACTION; ALTER TABLE "tribe" DROP CONSTRAINT IF EXISTS "FK_dcdd03e44f28bdf784d43314825"; ALTER TABLE "tribe" ADD CONSTRAINT "FK_dcdd03e44f28bdf784d43314825" FOREIGN KEY ("id_organization") REFERENCES "organization"("id_organization") ON DELETE NO ACTION ON UPDATE NO ACTION; ALTER TABLE "repository" DROP CONSTRAINT IF EXISTS "FK_3572e75b71052040481c022dfdd"; ALTER TABLE "repository" ADD CONSTRAINT "FK_3572e75b71052040481c022dfdd" FOREIGN KEY ("id_tribe") REFERENCES "tribe"("id_tribe") ON DELETE NO ACTION ON UPDATE NO ACTION; TRUNCATE TABLE "organization" CASCADE; INSERT INTO organization VALUES (1, 'Organization 1'); INSERT INTO tribe VALUES (1, 'Tribe 1', 1, 1); INSERT INTO repository (id_repository, name, status, id_tribe, state) VALUES (1, 'Repo 1', 'A', 1, 'E'); INSERT INTO metrics VALUES (1, 88.90, 10, 1, 1, 1); INSERT INTO repository (id_repository, name, status, id_tribe, state) VALUES (2, 'Repo 2', 'A', 1, 'E'); INSERT INTO metrics VALUES (2, 60.90, 10, 1, 1, 1); INSERT INTO repository (id_repository, name, status, id_tribe, state) VALUES (3, 'Repo 3', 'A', 1, 'D'); INSERT INTO metrics VALUES (3, 75.90, 10, 1, 1, 1); "
